<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenDAL WASM æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #log {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 4px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¦€ OpenDAL WASM æµ‹è¯•</h1>

        <div id="status" class="status info">æ­£åœ¨åŠ è½½ WASM æ¨¡å—...</div>

        <h2>æµ‹è¯•æ“ä½œ</h2>
        <button id="testInit" disabled>æµ‹è¯•åˆå§‹åŒ–</button>
        <button id="testTypes" disabled>æµ‹è¯•ç±»å‹å®šä¹‰</button>

        <h2>æ—¥å¿—è¾“å‡º</h2>
        <div id="log"></div>

        <h2>WASM ä¿¡æ¯</h2>
        <pre id="info">åŠ è½½ä¸­...</pre>
    </div>

    <script type="module">
        import init, { S3Client } from './pkg/opendal_wasm.js';

        const statusDiv = document.getElementById('status');
        const logDiv = document.getElementById('log');
        const infoDiv = document.getElementById('info');
        const testInitBtn = document.getElementById('testInit');
        const testTypesBtn = document.getElementById('testTypes');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff5555' : type === 'success' ? '#50fa7b' : '#8be9fd';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function showStatus(message, type) {
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
        }

        async function main() {
            try {
                log('å¼€å§‹åŠ è½½ WASM æ¨¡å—...', 'info');

                await init();

                log('âœ… WASM æ¨¡å—åŠ è½½æˆåŠŸï¼', 'success');
                showStatus('âœ… WASM æ¨¡å—åŠ è½½æˆåŠŸï¼å¯ä»¥è¿›è¡Œæµ‹è¯•ã€‚', 'success');

                testInitBtn.disabled = false;
                testTypesBtn.disabled = false;

                const wasmInfo = {
                    'æ¨¡å—çŠ¶æ€': 'å·²åŠ è½½',
                    'S3Client': typeof S3Client,
                    'æ„é€ å‡½æ•°': typeof S3Client.prototype.constructor,
                    'æ–¹æ³•': Object.getOwnPropertyNames(S3Client.prototype).filter(m => m !== 'constructor')
                };

                infoDiv.textContent = JSON.stringify(wasmInfo, null, 2);
                log('WASM ä¿¡æ¯å·²æ›´æ–°', 'info');

            } catch (error) {
                log(`âŒ åŠ è½½å¤±è´¥: ${error.message}`, 'error');
                showStatus(`âŒ WASM åŠ è½½å¤±è´¥: ${error.message}`, 'error');
                infoDiv.textContent = `é”™è¯¯: ${error.stack}`;
            }
        }

        testInitBtn.addEventListener('click', () => {
            try {
                log('æµ‹è¯• S3Client åˆå§‹åŒ–...', 'info');

                const client = new S3Client(
                    'test-access-key',
                    'test-secret-key',
                    'us-east-1',
                    'test-bucket',
                    null
                );

                log('âœ… S3Client åˆ›å»ºæˆåŠŸï¼', 'success');
                log(`Client ç±»å‹: ${typeof client}`, 'info');
                log(`å¯ç”¨æ–¹æ³•: ${Object.getOwnPropertyNames(Object.getPrototypeOf(client)).join(', ')}`, 'info');

                client.free();
                log('âœ… Client å·²é‡Šæ”¾', 'success');

            } catch (error) {
                log(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        });

        testTypesBtn.addEventListener('click', () => {
            log('æ£€æŸ¥ TypeScript ç±»å‹å®šä¹‰...', 'info');
            log(`S3Client æ˜¯ç±»: ${typeof S3Client === 'function'}`, 'info');
            log(`S3Client æœ‰ prototype: ${!!S3Client.prototype}`, 'info');
            log(`S3Client æœ‰ free æ–¹æ³•: ${typeof S3Client.prototype.free === 'function'}`, 'info');
            log(`S3Client æœ‰ list æ–¹æ³•: ${typeof S3Client.prototype.list === 'function'}`, 'info');
            log(`S3Client æœ‰ read æ–¹æ³•: ${typeof S3Client.prototype.read === 'function'}`, 'info');
            log(`S3Client æœ‰ write æ–¹æ³•: ${typeof S3Client.prototype.write === 'function'}`, 'info');
            log(`S3Client æœ‰ delete æ–¹æ³•: ${typeof S3Client.prototype.delete === 'function'}`, 'info');
            log(`S3Client æœ‰ stat æ–¹æ³•: ${typeof S3Client.prototype.stat === 'function'}`, 'info');
            log('âœ… æ‰€æœ‰ç±»å‹æ£€æŸ¥é€šè¿‡ï¼', 'success');
        });

        main();
    </script>
</body>
</html>
